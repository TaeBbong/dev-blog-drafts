### ë“¤ì–´ê°€ë©°

<img src="https://velog.velcdn.com/images/taebbong/post/232980df-0818-436a-be4b-be86d5d2c13e/image.png" width="100%">

ëª¨ë°”ì¼ ì²­ì²©ì¥ ìë™ ì €ì¥ ì•± **ì²­ëª¨**ë¥¼ ê°œë°œí•˜ë©´ì„œ ê³ ë¯¼í•˜ê³  ë¬¸ì œë¥¼ í•´ê²°í–ˆë˜ ê³¼ì •ì„ ê³µìœ í•©ë‹ˆë‹¤.

### ë¬¸ì œ ì¸ì‹ : ì²­ëª¨ëŠ” ì–´ë–»ê²Œ íƒ„ìƒí–ˆëŠ”ê°€?

<img src="https://velog.velcdn.com/images/taebbong/post/3b0cd276-4625-402b-8bb1-0db8f3cc8c7b/image.png" width="30%">

20ëŒ€ í›„ë°˜ì´ ë˜ì–´ê°€ë©´ì„œ ì£¼ë³€ì— ê²°í˜¼í•˜ëŠ” ë¶„ë“¤ì´ ë§ì´ ìˆìŠµë‹ˆë‹¤. ì¢…ì´ ì²­ì²©ì¥ë„ ì¢‹ì§€ë§Œ, ë°›ëŠ” ì…ì¥ì—ì„  ì¼ì •ì„ í™•ì¸í•  ë•Œ ë³´í†µ ëª¨ë°”ì¼ ì²­ì²©ì¥ì„ ë” ë§ì´ ë³´ê²Œ ë˜ë”ë¼êµ¬ìš”.
ì²­ì²©ì¥ì„ ë°›ê³ ë‚˜ì„œ ìº˜ë¦°ë”ì— ì¼ì •ê³¼ ì¥ì†Œë¥¼ ê·¸ë•Œê·¸ë•Œ ì €ì¥í•˜ë©´ í¸í•˜ê² ì§€ë§Œ, ë³´í†µ ì €ì¥í•˜ì§€ ì•Šê³  ë§¤ë²ˆ ì¹´í†¡ ì±„íŒ…ë°©ì— ë“¤ì–´ê°€ì„œ ëª¨ë°”ì¼ ì²­ì²©ì¥ì„ ì°¾ì•„ ì¼ì •ì„ í™•ì¸í•˜ëŠ” ì¼ì´ ì°¸ ë§ì•˜ìŠµë‹ˆë‹¤...
ë‹¤ë¥¸ ë¶„ë“¤ë„ ì €ì™€ ë¹„ìŠ·í•œ ê²½í—˜ì„ ë§ì´ í•˜ì…¨ì„ê±°ë¼ ìƒê°í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì‹ë³„í•œ ë¬¸ì œì ì€ 2ê°œê°€ ìˆì—ˆëŠ”ë°,

> 1. ëª¨ë°”ì¼ ì²­ì²©ì¥ì´ ì±„íŒ…ë°© ë§ˆë‹¤ í©ì–´ì ¸ìˆìœ¼ë‹ˆ, ì°¾ëŠ”ê²Œ ì–´ë µë‹¤. ëª¨ì—¬ì ¸ ìˆìœ¼ë©´ ì¢‹ê² ë‹¤.
> 2. ë§¤ë²ˆ ëª¨ë°”ì¼ ì²­ì²©ì¥ì„ ë°›ê³  ì¼ì •/ì¥ì†Œ ë“± ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ê·€ì°®ë‹¤. ì•Œì•„ì„œ ì €ì¥ë˜ë©´ ì¢‹ê² ë‹¤.

ì´ëŸ° ë¬¸ì œì ì„ ì¸ì‹í•˜ì—¬ **ì²­ëª¨** ì•±ì„ ê¸°íší•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

### ë¬¸ì œ í•´ê²° : ì²­ëª¨ëŠ” ì–´ë–»ê²Œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ”ê°€?

ì•ì„œ ì‹ë³„í•œ 2ê°œì˜ ë¬¸ì œì ì„ **ì²­ëª¨** ì•±ì€ ì•„ë˜ì™€ ê°™ì´ í•´ê²°í•©ë‹ˆë‹¤.

> 1. ëª¨ë°”ì¼ ì²­ì²©ì¥ ë§í¬ë¥¼ ì…ë ¥í•˜ì—¬ ì €ì¥, ëª¨ì•„ì„œ ë³¼ ìˆ˜ ìˆë‹¤.
> 2. ëª¨ë°”ì¼ ì²­ì²©ì¥ì„ "ì•Œì•„ì„œ" íŒŒì‹±í•˜ì—¬, ì¼ì •/ì¥ì†Œ ì •ë³´ë¥¼ ìº˜ë¦°ë”ì— ì €ì¥í•œë‹¤.

ì²«ë²ˆì§¸ ë¬¸ì œì— ëŒ€í•œ í•´ê²°ì€ ë¹„êµì  ê°„ë‹¨í•˜ê³  ë»”í•©ë‹ˆë‹¤. ëª¨ë°”ì¼ ì²­ì²©ì¥ ì „ìš© ë©”ëª¨ì•±ì„ ë§Œë“¤ê² ë‹¤ëŠ” ê²ƒì´ì£ .
ì´ ìì²´ë¡œë„ ëˆ„êµ°ê°€ì—ê² ì˜ë¯¸ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‚˜, ë¬¸ì œë¥¼ ì™„ì „íˆ í•´ê²°í–ˆë‹¤ê³  ë³´ê¸° ì–´ë µìŠµë‹ˆë‹¤.
ëª¨ë°”ì¼ ì²­ì²©ì¥ì˜ ë‚´ìš©ì„ **"ì•Œì•„ì„œ"** íŒŒì‹±í•˜ì—¬ ì¼ì • ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì´ **"ì²­ëª¨"**ì˜ **"í‚¥"**ì´ë¼ê³  í•  ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.

### ê°œë… ì¦ëª… : GPT APIê°€ "ì•Œì•„ì„œ" ëª¨ë°”ì¼ ì²­ì²©ì¥ì„ íŒŒì‹±í•  ìˆ˜ ìˆì„ê¹Œ?

![](https://velog.velcdn.com/images/taebbong/post/50e523f5-a499-4183-ace2-702d2727d6d5/image.png)

ì—¬ê¸°ì„œ **"ì•Œì•„ì„œ"** ëŠ” `GPT API`ê°€ ë§¡ì•„ì£¼ì—ˆìŠµë‹ˆë‹¤.
ëª‡ë²ˆì˜ í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´, `GPT API`ì—ê²Œ ëª¨ë°”ì¼ ì²­ì²©ì¥ ì›¹ í˜ì´ì§€ ë¦¬ì†ŒìŠ¤ë¥¼ ì „ë‹¬í•˜ë©´,
100%ì— ê°€ê¹Œìš´ ì •í™•ë„ë¡œ ì¼ì • ì •ë³´ë¥¼ íŒŒì‹±í•œë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

![](https://velog.velcdn.com/images/taebbong/post/d535972e-c14b-426c-b486-d19c8b47f183/image.png)

ì´ˆê¸°ì—ëŠ” ì§ì ‘ ëª¨ë°”ì¼ ì²­ì²©ì¥ ë§í¬ë¥¼ ì „ë‹¬í–ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¼ì • ì •ë³´ë¥¼ íŒŒì‹±í•´ë‹¬ë¼ê³  í–ˆì—ˆì£ .
í•˜ì§€ë§Œ `GPT API`ëŠ” ì›¹ í˜ì´ì§€ ì ‘ê·¼ê³¼ ê°™ì€ ì¸í„°ë ‰ì…˜ì— ë§¤ìš° ì œí•œì ì´ì—ˆìŠµë‹ˆë‹¤.
~~ì´ê²Œ ì˜¬í•´ ì´ˆì˜€ëŠ”ë°, ìš”ì¦˜ì—” ì›¹ íƒìƒ‰ ê¸°ëŠ¥ì´ ìƒê¸°ë©´ì„œ ì´ì   ë§í¬ë§Œ ë˜ì ¸ì¤˜ë„ ì•Œì•„ì„œ ì˜ ë˜ë”ë¼êµ¬ìš”...ğŸ˜…~~

```python
@https_fn.on_request(secrets=["OPENAI_API_KEY"])
def parse_voucher_handler(req: https_fn.Request) -> https_fn.Response:
    """POSTë¡œ link ë°ì´í„°ë¥¼ ì „ë‹¬ë°›ì•„ html íŒŒì‹±, gptë¥¼ í†µí•´ ì ì ˆí•œ ë°ì´í„° ì¶”ì¶œ ë° JSON(str)ì„ ë°˜í™˜í•˜ëŠ” API í•¸ë“¤ëŸ¬"""
    try:
        data = req.get_json()
        OPENAI_API_KEY = os.environ.get("OPENAI_API_KEY")
        voucher = data.get("link")
        parsed_result = HTML

        query = parsed_result + "\n\n"
        query += '''
        Extract the required wedding data from the given text and return it in pure JSON format, without any additional text or snippet tags. Ensure that the output follows this exact JSON structure:

        {
            "thumbnail": "",
            "groom": "",
            "bride": "",
            "datetime": "", // ex: 2025-04-26T14:00:00
            "location": ""
        }
         '''
        client = OpenAI(api_key=OPENAI_API_KEY)
        model = "gpt-4o-mini"
        messages = [{
            "role": "system",
            "content": "Parse the wedding voucher data into JSON format."
        }, {
            "role": "user",
            "content": query
        }]

        # GPT API í˜¸ì¶œ
        response = client.chat.completions.create(model=model, messages=messages, response_format={'type': 'json_object'})

        try:
            result = response.choices[0].message.content
            return https_fn.Response(json.dumps(result), status=200, mimetype="application/json", headers=headers)
        except Exception as e:
            return https_fn.Response(
            json.dumps({"error": str(e), "note": f"{result}"}), status=404, mimetype="application/json", headers=headers
        )

    except Exception as e:
        return https_fn.Response(
            json.dumps({"error": str(e) + str(req.get_json())}), status=500, mimetype="application/json", headers=headers
        )
```

ê·¸ ë‹¤ìŒ ì‹œë„ë¡œëŠ” `html` í˜ì´ì§€ ë¦¬ì†ŒìŠ¤ë¥¼ `python`ì˜ `requests`ë¥¼ í†µí•´ ê°€ì ¸ì˜¨ ë‹¤ìŒ, í•´ë‹¹ ë°ì´í„°ë¥¼ `GPT`ì—ê²Œ ì „ë‹¬í–ˆìŠµë‹ˆë‹¤.
ì´ë•Œ `GPT`ëŠ” ë†€ëê²Œë„ ì¼ì • ì •ë³´ë¥¼ íŒŒì‹±í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì•„ì£¼ ë†’ì€ ì •í™•ë„ë¡œ ë§ì´ì£ .

ì—¬ê¸°ê¹Œì§€ë§Œìœ¼ë¡œë„ `GPT API`ëŠ” ëª¨ë°”ì¼ ì²­ì²©ì¥ ë‚´ìš© íŒŒì‹±ì´ë¼ëŠ” ì„ë¬´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆì—ˆì§€ë§Œ, ì¢€ ë” ê°œì„ ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.
ì™œëƒí•˜ë©´ `html` í˜ì´ì§€ ë¦¬ì†ŒìŠ¤ì—ëŠ” ë¶ˆí•„ìš”í•œ ì •ë³´ê°€ ë„ˆë¬´ ë§ì•˜ê³ , ì¤‘ë³µëœ í…ìŠ¤íŠ¸ë„ ë§ì´ ìˆì—ˆìŠµë‹ˆë‹¤.
íŠ¹íˆ ì—¬ëŸ¬ ì• ë‹ˆë©”ì´ì…˜, ë””ìì¸ ë¦¬ì†ŒìŠ¤ê°€ í¬í•¨ë˜ëŠ” ëª¨ë°”ì¼ ì²­ì²©ì¥ì˜ íŠ¹ì„±ìƒ `html` í˜ì´ì§€ ì „ì²´ë¥¼ `GPT`ì—ê²Œ `input`ìœ¼ë¡œ ì „ë‹¬í•˜ë©´ ê·¸ ì†ë„ê°€ ë§ì´ ëŠë ¤ì§„ë‹¤ëŠ” ê²ƒì„ ì²´ê°í–ˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ì—¬ê¸°ì„œ í•œë²ˆ ë” ê°œì„ ì„ í•´ëƒˆìŠµë‹ˆë‹¤. `html`ì—ì„œ ë¶ˆí•„ìš”í•œ íƒœê·¸, ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¯¸ë¦¬ `BeautifulSoup`ê³¼ ê°™ì€ ì „í†µì ì¸ íŒŒì„œë¡œ ì œê±°í•˜ê³ , í…ìŠ¤íŠ¸, ì´ë¯¸ì§€ ë§í¬ ë“± ì£¼ìš” ì •ë³´ë§Œ ë‚¨ê²¨ì„œ `GPT`ì—ê²Œ `input`ìœ¼ë¡œ ì „ë‹¬í–ˆìŠµë‹ˆë‹¤.
ì´ë•Œ ì‘ë‹µì†ë„ê°€ í™•ì—°íˆ ë¹¨ë¼ì§€ëŠ” ê²ƒì„ í™•ì¸í–ˆê³ , `GPT API`ë¥¼ í™œìš©í•  ë•Œ ì„±ëŠ¥ ê°œì„ ì„ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```python
def extract_text_content(soup: BeautifulSoup, content_set: Set[str]) -> None:
    """ë³¸ë¬¸ í…ìŠ¤íŠ¸ ì½˜í…ì¸ ë¥¼ ì¶”ì¶œí•˜ì—¬ content_setì— ì¶”ê°€í•©ë‹ˆë‹¤."""
    for element in soup.find_all(["p", "h1", "h2", "h3", "h4", "h5", "h6", "li", "div", "script", "meta", "title"]):
        text = element.get_text(strip=True)
        if text and len(text) >= 2 and contains_korean(text):
            content_set.add(text)


def extract_media_content(soup: BeautifulSoup, content_set: Set[str]) -> None:
    """ì´ë¯¸ì§€ ë° ë§í¬ ì½˜í…ì¸ ë¥¼ ì¶”ì¶œí•˜ì—¬ content_setì— ì¶”ê°€í•©ë‹ˆë‹¤."""
    for img in soup.find_all("img"):
        if src := img.get("src"):
            content_set.add(f"[IMAGE] {src}")

    for link in soup.find_all("link"):
        if href := link.get("href"):
            content_set.add(f"[LINK] {href}")

    for anchor in soup.find_all("a"):
        href = anchor.get("href", "").strip()
        text = anchor.get_text(strip=True)
        if href:
            content_set.add(f"[ANCHOR] {text} â†’ {href}" if text else f"[ANCHOR] {href}")


def extract_content_with_images(url: str) -> str:
    """ì£¼ì–´ì§„ URLì—ì„œ í…ìŠ¤íŠ¸ì™€ ë¯¸ë””ì–´ ì½˜í…ì¸ ë¥¼ ì¶”ì¶œí•˜ì—¬ ì¶œë ¥í•©ë‹ˆë‹¤."""
    html = fetch_html(url)
    if not html:
        return

    soup = BeautifulSoup(html, "html.parser")

    for tag in soup(["style", "noscript", "link"]):
        tag.decompose()

    extracted_content: Set[str] = set()

    extract_text_content(soup, extracted_content)
    extract_media_content(soup, extracted_content)

    return "\n".join(sorted(extracted_content))
```

ìµœê·¼ì— ë°›ì€ ëª¨ë°”ì¼ ì²­ì²©ì¥ ì„œë¹„ìŠ¤ ì—…ì²´ë“¤ì´ ëª¨ë‘ ë‹¬ë¼ì„œ ë§ˆì¹¨ ì˜ ë˜ì—ˆë‹¤ ì‹¶ì–´ í…ŒìŠ¤íŠ¸ í–ˆì„ ë•Œ, ëª¨ë“  ì¢…ë¥˜ì˜ ì›¹ í˜ì´ì§€ì— ëŒ€í•´ `GPT`ê°€ ì˜ ë™ì‘í•¨ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ `GPT API`ì™€ ì—°ë™í•˜ì—¬ ë™ì‘í•˜ëŠ” ì½”ë“œë¥¼ ë§Œë“¤ì—ˆê³ , ì´ë¥¼ `Firebase Functions`ì— ë°°í¬í•˜ì—¬ ì•„ì£¼ ê°„ë‹¨í•œ ë°±ì—”ë“œ ì„œë²„ë¥¼ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.

### í´ë¦° ì•„í‚¤í…ì²˜ ì ìš©ê¸°

ë³¸ê²©ì ì¸ êµ¬í˜„ì— ì•ì„œ í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜ë¥¼ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.
ì—¬ê¸°ì„œëŠ” **í´ë¦° ì•„í‚¤í…ì²˜**ë¥¼ ì ìš©í•˜ì˜€ëŠ”ë°, ê·¸ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> 1. í´ë¦° ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ì´í•´ì™€ ì ìš© ì‹¤ìŠµ
> 2. ìµœì†Œê¸°ëŠ¥ìœ¼ë¡œ ì‹œì‘í•˜ì—¬ ë°±ì—”ë“œ, DB êµì²´ ê°€ëŠ¥ì„±ì´ ë†’ìŒ

í´ë¦° ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ê³µë¶€ê°€ ì¢€ ë” ë©”ì¸ ì´ìœ ì˜€ëŠ”ë°, ì´ ê³¼ì •ì—ì„œ í´ë¦° ì•„í‚¤í…ì²˜ì˜ ì •ë‹µì„ ì°¾ê¸°ë³´ë‹¨ ì² í•™ì„ ì¡´ì¤‘í•˜ê³  ë”°ë¥´ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤ê³  ëŠê¼ˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ í•µì‹¬ì ìœ¼ë¡œ ìƒê°í•œ ì² í•™ë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> 1. ê°€ì¥ ì•ˆìª½ì˜ ë ˆì´ì–´ëŠ” ì—”í‹°í‹°, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìœ¼ë¡œ êµ¬ì„±ë˜ë©° ì´ë“¤ì€ ì™¸ë¶€ ì˜ì¡´ì„±ì´ ì—†ê±°ë‚˜ ìµœì†Œê°€ ë˜ì–´ì•¼ í•œë‹¤.
> 2. ì´ë¥¼ ìœ„í•´ ì¶”ìƒí™”ë¡œ ì˜ì¡´ì„± ì—­ì „ì„ ë°œìƒì‹œí‚¨ë‹¤.
> 3. ê° íŒŒì¼/í´ë˜ìŠ¤ëŠ” í•œê°€ì§€ ì±…ì„ì„ ê°€ì§€ê²Œ í•˜ì—¬ ê²°í•©ë„ë¥¼ ë‚®ì¶˜ë‹¤.

ìœ„ì™€ ê°™ì€ ì² í•™ë“¤ì„ ìš°ì„ ì ìœ¼ë¡œ ì§€í‚¤ê²Œë” ì„¤ê³„í•˜ê³  ê°œë°œí–ˆìŠµë‹ˆë‹¤.

ìµœì¢…ì ìœ¼ë¡œ ì„ íƒí•œ í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ì€ë°,

```css
ğŸ“‚ core/
   â”œâ”€â”€ di/             (ì˜ì¡´ì„± ì£¼ì…)
   â”œâ”€â”€ services/       (Push Notifications ì„œë¹„ìŠ¤)
   â”œâ”€â”€ utils/          (ê³µí†µ ìœ í‹¸ í•¨ìˆ˜)
   â”œâ”€â”€ env.dart        (ê°ì¢… ì„¤ì • ê°’)

ğŸ“‚ data/
   â”œâ”€â”€ mapper/         (ë°ì´í„° ëª¨ë¸ <-> ì—”í‹°í‹° ë³€í™˜ê¸°)
   â”œâ”€â”€ models/         (ë°ì´í„° ëª¨ë¸)
   â”œâ”€â”€ repositories/   (ë ˆí¬ì§€í† ë¦¬ êµ¬í˜„ì²´)
   â”œâ”€â”€ sources/        (ë¡œì»¬, ì›ê²© ë°ì´í„° ì†ŒìŠ¤)

ğŸ“‚ domain/
   â”œâ”€â”€ entities/       (ìˆœìˆ˜ ë„ë©”ì¸ ëª¨ë¸)
   â”œâ”€â”€ repositories/   (ë ˆí¬ì§€í† ë¦¬)
   â”œâ”€â”€ usecases/       (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)

ğŸ“‚ presentation/
   â”œâ”€â”€ controllers/    (ë·°ëª¨ë¸)
   â”œâ”€â”€ pages/          (í™”ë©´ UI)
   â”œâ”€â”€ widgets/        (ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìœ„ì ¯ë“¤)
   â”œâ”€â”€ themes/         (ì•± í…Œë§ˆ ê´€ë¦¬)

main.dart
```

ì•„í‚¤í…ì²˜ë¥¼ ì„¤ê³„í•˜ê³  ê°œë°œì— ë“¤ì–´ê°€ë©´ì„œ ëŒ€ë¶€ë¶„ì˜ ê°œë°œìë“¤ì´ í•˜ëŠ” ê³ ë¯¼ì„ ë¹„ìŠ·í•˜ê²Œ ê²ªì—ˆìŠµë‹ˆë‹¤.

#### 1. usecaseëŠ” ì™œ ìˆëŠ”ê±°ì§€?

ì²˜ìŒ ê³µë¶€í•  ë• `usecase`ê°€ ë¹„êµì  ë¶ˆí•„ìš”í•´ë³´ì—¬ì„œ ë¹¼ê³  êµ¬í˜„í•˜ë ¤ í–ˆìŠµë‹ˆë‹¤.
ê·¸ëŸ¼ì—ë„ ìµœì¢…ì ìœ¼ë¡œëŠ” `usecase`ë¥¼ êµ¬í˜„í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

`usecase`ê°€ ìˆì–´ì•¼ í–ˆë˜ ì‚¬ë¡€ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```dart
Future<List<Schedule>> getSchedules() async {
  final List<ScheduleModel> schedules = await localSource.getAllSchedules();
  final List<Schedule> entitySchedules =
      schedules.map((e) => ScheduleMapper.toEntity(e)).toList();
  return entitySchedules;
}
```

ì´ ì½”ë“œëŠ” `data/repository`ì— ì‘ì„±ëœ ì½”ë“œì…ë‹ˆë‹¤.
ë¡œì»¬ ë°ì´í„° ì†ŒìŠ¤, ì¦‰ `sqflite`ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë ˆí¬ì§€í† ë¦¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤.
ì´ ë°ì´í„° ì ‘ê·¼ ê¸°ëŠ¥ì€ ì—¬ëŸ¬ ê³³ì—ì„œ ì“°ì…ë‹ˆë‹¤.

> 1. Calendar ìœ„ì ¯ì—ì„œ ì¼ì •ì„ ë‹¬ë ¥ì— í‘œì‹œí•˜ê¸° ìœ„í•´
> 2. ListView ìœ„ì ¯ì—ì„œ ì•ìœ¼ë¡œì˜ ì¼ì •, ì§€ë‚œ ì¼ì •ì„ í‘œì‹œí•˜ê¸° ìœ„í•´
> 3. ë©”ì¸ í˜ì´ì§€ì—ì„œ ë“±ë¡ëœ ì¼ì • ìˆ˜ë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•´

ì´ë•Œ ê° ì‚¬ìš©ì²˜ì—ì„œëŠ” í•„ìš”í•œ ë°ì´í„°ì˜ í˜•íƒœë‚˜ ë²”ìœ„ ë“±ì´ ë‹¤ë¦…ë‹ˆë‹¤.

> 1. Calendar ìœ„ì ¯ : ì „ì²´ ì¼ì • ì¤‘ ì›” ë‹¨ìœ„ ë°ì´í„°ê°€ í•„ìš”í•¨
> 2. ListView ìœ„ì ¯ : í˜„ì¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì „ì²´ ì¼ì •ì„ ë‘˜ë¡œ ë‚˜ëˆˆ ë¦¬ìŠ¤íŠ¸ê°€ í•„ìš”í•¨
> 3. ë©”ì¸ í˜ì´ì§€ : ì „ì²´ ì¼ì •ì˜ ìˆ˜ê°€ í•„ìš”í•¨

í´ë¦° ì•„í‚¤í…ì²˜ì˜ ê´€ì ì—ì„œ ë³´ë©´,
ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê¸°ëŠ¥ ìì²´ëŠ” **data ì˜ì—­**ì—ì„œ ë‹¤ë¤„ì§€ëŠ”ê²Œ ì ì ˆí•˜ì§€ë§Œ, ì´ë ‡ê²Œ ì‚¬ìš©ì²˜ë§ˆë‹¤ í•„ìš”í•œ ë°ì´í„°ë¥¼ ê°€ê³µí•˜ëŠ” ì½”ë“œëŠ” data ì˜ì—­ë³´ë‹¨ **domain ì˜ì—­**ì´ ë” ì–´ìš¸ë¦½ë‹ˆë‹¤.
ì™œëƒí•˜ë©´ ì‚¬ìš©ì²˜ì—ì„œ ì›í•˜ëŠ” ë°ì´í„°ì˜ ì–‘ì‹ì€ ì‚¬ìš©ì²˜ê°€ ì œì¼ ì˜ ì•Œê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë˜í•œ ìœ„ì ¯ê³¼ ê°™ì€ ì‚¬ìš©ì²˜ëŠ” ì¶”ê°€/ìˆ˜ì •ì´ ì¦ê²Œ ì¼ì–´ë‚©ë‹ˆë‹¤.
ì¶”ê°€ë‚˜ ìˆ˜ì •ì´ í•„ìš”í•  ë•Œë§ˆë‹¤ `repository`ë¥¼ í¸ì§‘í•˜ëŠ” ê²ƒë³´ë‹¤, ê¸°ì¡´ì˜ `repository`ì—ì„œ ì œê³µí•˜ëŠ” ë°ì´í„°ë¥¼ í™œìš©í•´ ìƒˆë¡œìš´ `usecase`ë¥¼ ë§Œë“œëŠ”ê²Œ ë” ë¹„ìš©ì´ ì ê²Œ ë“¤ê² ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ `usecase`ëŠ” ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ ê²°ì •í–ˆê³ , ì´ë¥¼ ì ìš©í•œ ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```dart
/// ì „ì²´ ì¼ì •ì„ ê°€ì ¸ì™€ ì œê³µí•˜ëŠ” ìœ ì¦ˆì¼€ì´ìŠ¤
class ListSchedulesUsecase {
  final ScheduleRepository repository;
  ListSchedulesUsecase(this.repository);

  Future<List<Schedule>> execute() {
    return repository.getSchedules();
  }
}

/// ì „ì²´ ì¼ì •ì˜ ìˆ˜ë¥¼ ì œê³µí•˜ëŠ” ìœ ì¦ˆì¼€ì´ìŠ¤
class CountSchedulesUsecase {
  final ScheduleRepository repository;
  CountSchedulesUsecase(this.repository);

  Future<int> execute() async {
    List<Schedule> schedules = await repository.getSchedules();
    return schedules.length;
  }
}
```

#### 2. data/modelê³¼ domain/entity ë‘˜ë‹¤ í•„ìš”í•œê°€?

**data/model**ê³¼ **domain/entity**ëŠ” ê·¸ ì½”ë“œê°€ ìœ ì‚¬í•˜ì§€ë§Œ, ê°œë…ì ìœ¼ë¡œ ì§€í–¥í•˜ëŠ” ë°”ê°€ ì™„ì „íˆ ë‹¤ë¦…ë‹ˆë‹¤.

`Entity`ëŠ” ì‚¬ìš©ìì—ê²Œ ì œê³µë˜ëŠ” ë°ì´í„°, ëª¨ë¸ì€ DBë‚˜ ì„œë²„ì—ì„œ ì²˜ë¦¬ë˜ëŠ” ë°ì´í„°ë¥¼ êµ¬í˜„í•œ ê²ƒì…ë‹ˆë‹¤.

ê°œë…ì ìœ¼ë¡œ ë‹¤ë¥´ì§€ë§Œ ì‚¬ì‹¤ í•˜ë‚˜ë§Œ ì¨ë„ êµ¬í˜„í•˜ëŠ”ë° í° ë¬¸ì œëŠ” ì—†ìŠµë‹ˆë‹¤.
ê·¸ëŸ¼ì—ë„ íŒ¨í„´ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ì´ìœ ê°€ ìˆëŠ”ë°, ì´ í”„ë¡œì íŠ¸ì—ì„œë„ ê·¸ëŸ° ì‚¬ë¡€ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

```dart
@freezed
class ScheduleModel with _$ScheduleModel {
  factory ScheduleModel({
    required String link,
    required String thumbnail,
    required String groom,
    required String bride,
    required String date,
    required String location,
  }) = _ScheduleModel;

  factory ScheduleModel.fromJson(Map<String, dynamic> json) =>
      _$ScheduleModelFromJson(json);
}
```

ì´ ì½”ë“œëŠ” í”„ë¡œì íŠ¸ ì´ˆê¸°ì— ì‚¬ìš©ëœ `Schedule` **ëª¨ë¸**ì…ë‹ˆë‹¤.
ì´ë• ëª¨ë¸ê³¼ ì—”í‹°í‹°ì˜ êµ¬ë¶„ í•„ìš”ë¥¼ ëŠë¼ì§€ ëª»í•˜ì—¬ ëª¨ë¸ í•˜ë‚˜ë§Œìœ¼ë¡œ ë°ì´í„° ì €ì¥, ì„œë²„ í†µì‹ , UI í‘œí˜„ ë“± ëª¨ë“  ê³³ì— ì ìš©í•˜ì—¬ ì™”ìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ íŠ¹ì´í•œ ì ì€ `date`ë¥¼ `String` íƒ€ì…ìœ¼ë¡œ ì„ ì–¸í•œ ê²ƒì¸ë°, ì´ëŠ” ë¡œì»¬ DBì¸ `sqflite`ì— `DateTime` íƒ€ì…ì´ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë”°ë¼ì„œ í•´ë‹¹ ëª¨ë¸ë¡œ DBì— ì €ì¥í•˜ê¸° ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ `String` íƒ€ì…ìœ¼ë¡œ ì„ ì–¸í•´ì•¼ í–ˆê³ , ë‚˜ì¤‘ì— `DateTime`ì„ í¸ì§‘í•´ì•¼ í•˜ëŠ” UI ê¸°ëŠ¥ì„ êµ¬í˜„í•  ë•Œì—ëŠ”,

```dart
ScheduleModel(date: today.toIso8601String());
...
DateTime date = DateTime.parse(schedule.date);
```

ì´ë ‡ê²Œ **String <-> DateTime** ë³€í™˜ì„ ê·¸ë•Œê·¸ë•Œ ì‚¬ìš©í•´ì™”ìŠµë‹ˆë‹¤.

ë„ˆë¬´ ë¶ˆí¸í•œ ë°©ë²•ì´ì£ ?
ì´ë ‡ê²Œ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ê³  í¸ì§‘í•˜ëŠ” ê¸°ëŠ¥ì´ ì—¬ëŸ¬ê³³ì— í©ì–´ì§€ë©´ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ì§€í‚¤ê¸° ì–´ë ¤ì› ìŠµë‹ˆë‹¤.

ì´ë•Œ ì—”í‹°í‹°ì˜ í•„ìš”ì„±ì„ ëŠë¼ê³ , ì˜¤ë¡¯ì´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ UIë¥¼ ìœ„í•œ ì—”í‹°í‹°ë¥¼ ë³„ë„ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

```dart
// domain/schedule.dart
@freezed
class Schedule with _$Schedule {
  const factory Schedule({
    required String link,
    required String thumbnail,
    required String groom,
    required String bride,
    required DateTime date,
    required String location,
  }) = _Schedule;
}
```

ê·¸ë¦¬ê³  ì—”í‹°í‹° <-> ëª¨ë¸ ë³€í™˜ì„ ìœ„í•œ **Mapper**ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

```dart
// data/mapper/schedule_mapper.dart
import '../models/schedule/schedule_model.dart';
import '../../domain/entities/schedule.dart';

/// ScheduleMapper class converts Schedule(entity, domain) <-> ScheduleModel(model, data)
class ScheduleMapper {
  /// Converts Schedule(entity, domain) -> ScheduleModel(model, data)
  static ScheduleModel toModel(Schedule entity) {
    return ScheduleModel(
      link: entity.link,
      thumbnail: entity.thumbnail,
      groom: entity.groom,
      bride: entity.bride,
      date: entity.date.toIso8601String(),
      location: entity.location,
    );
  }

  /// Converts ScheduleModel(model, data) -> Schedule(entity, domain)
  static Schedule toEntity(ScheduleModel model) {
    return Schedule(
      link: model.link,
      thumbnail: model.thumbnail,
      groom: model.groom,
      bride: model.bride,
      date: DateTime.parse(model.date),
      location: model.location,
    );
  }
}
```

ì´ì²˜ëŸ¼ ëª¨ë¸ê³¼ ì—”í‹°í‹°ë¥¼ ë³„ë„ë¡œ êµ¬í˜„í•˜ì—¬ ì–»ì€ ì´ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> 1. ìˆœìˆ˜í•œ ì—”í‹°í‹° ëª¨ë¸ì„ í†µí•´ ì‚¬ìš©ìì—ê²Œ ì¼ê´€ëœ ë°ì´í„°ë¥¼ ì œê³µ
> 2. UIì™€ DB ë“± ì“°ì´ëŠ” ì—¬ëŸ¬ê³³ì—ì„œ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ì§€ ì•Šê³  Mapperë¥¼ í†µí•´ ë°ì´í„° ë³€í™˜ ì¼ê´€ì„± ìœ ì§€
> 3. ì¶”í›„ DB, ì„œë²„ ë“± ë°ì´í„° ì†ŒìŠ¤ë¥¼ êµì²´í•  ë•Œ ì—”í‹°í‹°ì— ì˜ì¡´í•˜ëŠ” UI, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ìœ ì§€í•  ìˆ˜ ìˆìŒ(ëª¨ë¸ê³¼ ë ˆí¬ì§€í† ë¦¬ë§Œ ìˆ˜ì •í•˜ë©´ ë¨!)

### Trouble Shooting #1 : ì¼ì • ìˆ˜ì • í›„ ë‹¬ë ¥ìœ¼ë¡œ ëŒì•„ì™”ì„ ë•Œ ìƒíƒœ ë³€í™” ì ìš© ì‹œí‚¤ê¸°

ëª¨ë°”ì¼ ì²­ì²©ì¥ì„ íŒŒì‹±í•˜ì—¬ ë“±ë¡í•œ ì¼ì •ì„ ë‹¬ë ¥ì— ë³´ì—¬ì£¼ê²Œë” êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
í”ŒëŸ¬í„°ì—ì„œëŠ” `table_calendar`ë¼ëŠ” ìœ„ì ¯ì„ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

![](https://velog.velcdn.com/images/taebbong/post/5aa63501-1ac2-4b62-9703-0f46ab7e9486/image.png)

í˜„ì¬ ì•±ì—ì„œëŠ” `CalendarView`, `ListView`ì—ì„œ ì¼ì •ì„ ì„ íƒí•˜ë©´ `DetailPage`ë¡œ ì´ë™í•˜ê³ , `DetailPage`ì—ì„œëŠ” ìˆ˜ì • ê¸°ëŠ¥ì´ ì œê³µë©ë‹ˆë‹¤.
ì—¬ê¸°ì„œ ì¼ì •ì„ ìˆ˜ì •í•˜ê³  ë‚˜ì„œ ëŒì•„ê°€ë©´ `CalendarView`, `ListView`ë¡œ ëŒì•„ì˜¤ê²Œ ë˜ëŠ”ë°ìš”,
ê¸°ë³¸ì ìœ¼ë¡œ í”ŒëŸ¬í„°ëŠ” ë’¤ë¡œ ê°€ê¸° ì•¡ì…˜ì—ì„œëŠ” í™”ë©´ì´ ìƒˆë¡œ ë Œë”ë§ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ ì¼ì •ì„ ìˆ˜ì •í•´ë„ ê·¸ ìƒíƒœì—ì„œëŠ” ìº˜ë¦°ë”ì— ë°˜ì˜ì´ ì•ˆëœ ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ ë©ë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì²˜ìŒ ì„ íƒí•œ ë°©ë²•ì€ ìº˜ë¦°ë”ë¡œ ëŒì•„ì˜¬ ë•Œ ìº˜ë¦°ë” í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.
ì´ ë°©ë²•ì„ ì²˜ìŒ ë– ì˜¬ë¦° ì´ìœ ëŠ” ê°€ì¥ êµ¬í˜„í•˜ê¸° ì‰¬ìš´ ë°©ë²•ì´ê¸° ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤.
ë¼ìš°í„°ë¥¼ í™œìš©í•´ ê¸°ì¡´ ë¼ìš°íŒ… ê¸°ë¡ì„ ì „ë¶€ ì§€ìš°ê³ , ë©”ì¸ì—ì„œ ìº˜ë¦°ë” í˜ì´ì§€ë¡œ ë¼ìš°íŒ… ì‹œí‚¤ëŠ” ë°©ë²•ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```dart
Get.offNamedUntil('/calendar', (route) => route.settings.name == '/');
```

ê¸°ì¡´ì—ëŠ”

<img src="https://velog.velcdn.com/images/taebbong/post/902c817e-2e62-47d4-9d50-81da6fc976d9/image.png" width="70%">
ì˜€ë‹¤ë©´,

<img src="https://velog.velcdn.com/images/taebbong/post/45fac4ac-5422-4eff-aa58-2bda3e53916b/image.png" width="70%">

ì´ë ‡ê²Œ ë§ì´ì£ .

ì´ëŠ” ë’¤ë¡œê°€ê¸° ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ ì‹¤ì œë¡œëŠ” ìƒˆë¡œ í˜ì´ì§€ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ìƒˆë¡œê³ ì¹¨ì´ ë˜ê³ , ìˆ˜ì •ì‚¬í•­ì´ ë°˜ì˜ë˜ì–´ ë³´ì…ë‹ˆë‹¤.

ê¸°ëŠ¥ì ìœ¼ë¡œ ë¬¸ì œëŠ” ì—†ì§€ë§Œ, `DetailPage`ë¥¼ ë³´ê³  ëŒì•„ì˜¬ ë•Œë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨ë˜ëŠ” ìº˜ë¦°ë” í˜ì´ì§€ëŠ” ì‚¬ìš©ìì—ê²Œ ì¢‹ì§€ ëª»í•œ ê²½í—˜ì…ë‹ˆë‹¤.

ë‹¤ìŒìœ¼ë¡œ ì°¾ì€ í•´ê²°ë°©ë²•ì€ `PopScope` ìœ„ì ¯ê³¼ `Routing Argument`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.
`PopScope` ìœ„ì ¯ì„ ì‚¬ìš©í•˜ë©´, í•´ë‹¹ ìœ„ì ¯ì´ popë  ë•Œì˜ ì½œë°±ì„ ì •ì˜í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ë¥¼ í†µí•´ `DetailPage`ë¥¼ `PopScope`ë¡œ ê°ì‹¸ê³ , ì—¬ê¸°ì„œ popí•  ë•Œ ìˆ˜ì •ëœ `Schedule` ê°ì²´ë¥¼ `Routing Argument`ë¡œ ì „ë‹¬í•˜ì—¬ ìµœì¢…ì ìœ¼ë¡œ ìº˜ë¦°ë” í˜ì´ì§€ì˜ `Controller`ë¥¼ í†µí•´ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ í•˜ëŠ” êµ¬ì¡°ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

ë¨¼ì €, `DetailPage`ì—ì„œ `PopScope`ë¡œ ìœ„ì ¯ì´ popë  ë•Œì˜ ì´ë²¤íŠ¸ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

```dart
// DetailPage
return PopScope(
  canPop: false,
  onPopInvokedWithResult: (didPop, result) {
    if (didPop) return;
    Get.back(result: controller.schedule.value); // ëŒì•„ê°ˆ ë•Œ ë³€í•œ ìƒíƒœ(Schedule)ë¥¼ ì „ë‹¬
  },
  child: Scaffold(),
);
```

`DetailPage`ë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼ì—ì„œëŠ” `Get.back()`ìœ¼ë¡œë¶€í„° ê°’ì„ ìˆ˜ì‹ í•  ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬í•˜ë©°,
`CalendarController`ë¥¼ ì´ìš©í•´ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤.

```dart
// ScheduleListTile from CalendarView
return GestureDetector(
  onTap: () async {
    final updated = await Get.toNamed('/detail', arguments: schedule); // Get.back()ìœ¼ë¡œë¶€í„° ê°’ì„ ì „ë‹¬ë°›ê³ ,
    final calendarController = Get.find<CalendarController>();
    calendarController.onUpdateSchedule(updatedSchedule: updated); // CalendarControllerì—ì„œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì§„í–‰
  },
  ...
);
```

ê·¸ë¦¬í•˜ì—¬ `CalendarController`ì—ì„œ ìˆ˜ì •ëœ `Schedule` ìƒíƒœë¥¼ ë°˜ì˜í•˜ë©°,

```dart
// CalendarController
Future<void> onUpdateSchedule({required Schedule updatedSchedule}) async {
  // Step 1. Update focusedDay, selectedDay for CalendarView.
  focusedDay.value = updatedSchedule.date;
  selectedDay.value = updatedSchedule.date;

  // Step 2. Update `allSchedules` by key `link`.
  final currentList = allSchedules.value ?? [];
  final updatedList = currentList.map((s) {
    if (s.link == updatedSchedule.link) {
      return updatedSchedule;
    }
    return s;
  }).toList();
  allSchedules.value = updatedList;
}
```

`Obx`ë¡œ ìƒíƒœ ë³€í™”ë¥¼ ê°ì§€í•˜ëŠ” ìœ„ì ¯ì´ ìƒíƒœì˜ ë³€í™”ë§Œì„ í™”ë©´ì— ì ìš©, ë¦¬ë Œë”ë§í•©ë‹ˆë‹¤.

```dart
// CalendarView
class CalendarView extends StatelessWidget {
  final CalendarController _controller = Get.find<CalendarController>();

  @override
  Widget build(BuildContext context) {
    return Obx(() {
      final normalizedSelectedDay = DateTime(
          _controller.selectedDay.value.year,
          _controller.selectedDay.value.month,
          _controller.selectedDay.value.day);
      final eventCounts = _controller.schedulesWithDate.value ?? {};
      return Column(
        children: [
          TableCalendar(
            key: ValueKey(eventCounts.hashCode),
            locale: 'ko_KR',
            firstDay: DateTime(2000, 1, 1),
            lastDay: DateTime(2100, 12, 31),
            focusedDay: _controller.focusedDay.value,
            ...
          )
        ]
      );
    });
  }
}
```

ì´ë¥¼ í†µí•´ ìˆ˜ì • í›„ ëŒì•„ì˜¤ë”ë¼ë„ ìº˜ë¦°ë” ìœ„ì ¯ì´ ìƒˆë¡œê³ ì¹¨ë˜ì§€ ì•ŠëŠ” ìì—°ìŠ¤ëŸ¬ìš´ UXë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

> ìµœê·¼ **Flutter Seoul 4ì›” ì˜¤í”ˆ ìŠ¤í…Œì´ì§€**ì—ì„œ **ì‹¤ì‹œê°„ ìƒíƒœ ë™ê¸°í™” ì „ëµ**ì— ëŒ€í•´ ê³ ë¯¼í•´ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì—°ì‚¬ë‹˜ì€ `Bloc`, `Stream`ì„ `usecase`ê°€ êµ¬ë…í•˜ê²Œë” êµ¬í˜„í–ˆë‹¤ê³  í–ˆëŠ”ë°, ì—­ì‹œ ì‹¤ì‹œê°„ ìƒíƒœ ë™ê¸°í™”ì—ëŠ” `Stream`ì´ ì ì ˆí•œ ë“¯ í•˜ë„¤ìš”. ë‹¤ìŒ ë¦¬íŒ©í† ë§ì—ì„œëŠ” `Stream`ì„ ì ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.

### Trouble Shooting #2 : ë¡œì»¬ í‘¸ì‹œ ì•Œë¦¼ ì˜ˆì•½ ê¸°ëŠ¥ êµ¬í˜„

í‘¸ì‹œ ì•Œë¦¼ì€ ë³´ë‚´ëŠ” ì£¼ì²´ê°€ ëˆ„êµ¬ëƒì— ë”°ë¼ ë¡œì»¬ê³¼ ì„œë²„ë¡œ ë°©ì‹ì´ ë‚˜ë‰˜ëŠ”ë°, ê¸°ë³¸ì ìœ¼ë¡œ ì´ ì•±ì—ì„œ ìŠ¤ì¼€ì¥´ ë°ì´í„°ëŠ” ì„œë²„ê°€ ì•„ë‹Œ ë¡œì»¬ DBì— ì €ì¥ë˜ê¸° ë•Œë¬¸ì— ë‹¹ì—°íˆ ë¡œì»¬ í‘¸ì‹œ ì•Œë¦¼ì„ ë¨¼ì € ê³ ë ¤í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

![ì²­ëª¨ ì•±ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ ê¸°ëŠ¥ UI]()

ì œê°€ ê¸°íší•œ í‘¸ì‹œ ì•Œë¦¼ì€ ëª¨ë°”ì¼ ì²­ì²©ì¥ì˜ ê²°í˜¼ì‹ ì¼ì • ì „ë‚  11ì‹œì¯¤ **"ë‹¤ìŒë‚  OOOë‹˜ì˜ ê²°í˜¼ì‹ì´ ìˆì–´ìš”!"**ì™€ ê°™ì€ í‘¸ì‹œ ì•Œë¦¼ì„ ì œê³µí•˜ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.

ë‹¹ì—°íˆ ì´ í‘¸ì‹œ ì•Œë¦¼ì€ ì•±ì´ ì¢…ë£Œë˜ì–´ë„ ë°œìƒí•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.

ìµœì´ˆì— ìƒê°í–ˆë˜ ë°©ì‹ì€ ë§¤ì¼ 11ì‹œì— DBë¥¼ ì¡°íšŒí•˜ì—¬ ë‹¤ìŒë‚ ë¡œ ì €ì¥ëœ ì¼ì •ì„ ì°¾ìœ¼ë©´ í‘¸ì‹œ ì•Œë¦¼ì„ ì œê³µí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìƒê°í–ˆì—ˆì–´ìš”.
ì´ ë°©ì‹ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” **ë°±ê·¸ë¼ìš´ë“œë¡œ ëŒì•„ê°€ëŠ” "ì„œë¹„ìŠ¤"**ë¥¼ êµ¬í˜„í•´ì•¼ í•˜ê³ , ì´ ì„œë¹„ìŠ¤ê°€ ì •í•´ì§„ ì‹œê°ì— **ì‘ì—…ì„ í•˜ë„ë¡ ì˜ˆì•½**í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ ì•Œì•„ë³¸ í”ŒëŸ¬í„° ë ˆë²¨ì˜ íŒ¨í‚¤ì§€ëŠ” `WorkManager`ì˜€ìŠµë‹ˆë‹¤.
`WorkManager`ëŠ” í”ŒëŸ¬í„°ì—ì„œ ë„¤ì´í‹°ë¸Œ ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ ìµœì„ ì˜ ì„ íƒì§€ì˜€ìŠµë‹ˆë‹¤ë§Œ, íŒ¨í‚¤ì§€ë¥¼ ì ìš©í•˜ë©´ ë¹Œë“œê°€ ì•ˆë˜ëŠ” ì´ìŠˆê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì €ë§Œ ì•ˆë˜ëŠ” ì¤„ ì•Œì•˜ëŠ”ë°, ë‹¤ë“¤ ê²ªê³  ìˆëŠ” ë¬¸ì œë”ë¼êµ¬ìš”..

<img src="https://velog.velcdn.com/images/taebbong/post/90f7bb27-5159-45e2-a710-ccf105ccdc2d/image.png" width="70%">

ì´í›„ì— ì§ì ‘ íŒ¨í‚¤ì§€ë¥¼ í™œìš©í•´ êµ¬í˜„í–ˆì„ ë•Œì—ë„ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
~~ì´ë•Œ í‘¸ì‹œ ì•Œë¦¼ì„ ë•Œë ¤ì¹ ê¹Œ ê³ ë¯¼ ë§ì´ í–ˆìŠµë‹ˆë‹¤ë§Œ..~~
ë‹¤ë¥¸ ë°©ì‹ì˜ í‘¸ì‹œ ì•Œë¦¼ì„ ê³ ë¯¼í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´í›„ì— ì„ íƒí•œ ë°©ì‹ì€ **ìƒˆë¡œìš´ ìŠ¤ì¼€ì¥´ì´ ë“±ë¡ë  ë•Œë§ˆë‹¤** í‘¸ì‹œ ì•Œë¦¼ì„ ë³´ë‚¼ ë‚ ì§œë¥¼ ê³„ì‚°í•˜ì—¬ í‘¸ì‹œ ì•Œë¦¼ì„ **ì˜ˆì•½**í•˜ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.
ì´ëŠ” ìŠ¤ì¼€ì¥´ ë“±ë¡ ë¿ë§Œ ì•„ë‹ˆë¼ ìŠ¤ì¼€ì¥´ ìˆ˜ì • ë•Œì—ë„ ê¸°ì¡´ í‘¸ì‹œ ì•Œë¦¼ ì˜ˆì•½ì„ ì·¨ì†Œí•˜ê³  ìƒˆë¡œ ë‚ ì§œë¥¼ ê³„ì‚°í•˜ì—¬ ë“±ë¡í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì¼í•˜ê²Œ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì„œ í‘¸ì‹œ ì•Œë¦¼ì„ ì˜ˆì•½í•˜ëŠ” ê¸°ëŠ¥ì€ `flutter_local_notifications` íŒ¨í‚¤ì§€ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<img src="https://velog.velcdn.com/images/taebbong/post/9dce35b1-d0c1-4bf5-ba36-d9b096cbce2b/image.png" width="70%">

í•´ë‹¹ íŒ¨í‚¤ì§€ëŠ” ê° ë„¤ì´í‹°ë¸Œ ê¸°ê¸°ì˜ ì•Œë¦¼ ìŠ¤ì¼€ì¥´ëŸ¬ë¥¼ í™œìš©í•  ìˆ˜ ìˆê³ , ê°œë°œí•˜ëŠ” ì…ì¥ì—ì„œ ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ êµ¬í˜„ ì—†ì´ ë„¤ì´í‹°ë¸Œí•œ ë°©ì‹ìœ¼ë¡œ í‘¸ì‹œ ì•Œë¦¼ ì˜ˆì•½ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ ë°±ê·¸ë¼ìš´ë“œ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•  í•„ìš”ê°€ ì—†ê³ , ì‹¬ì§€ì–´ ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë§¤ì¼ ê°™ì€ ì‹œê°ì—*(í‘¸ì‹œ ì•Œë¦¼ì„ ë³´ë‚¼ë§Œí•œ ìŠ¤ì¼€ì¥´ì´ ìˆì„ì§€ ì—†ì„ì§€ë„ ëª¨ë¥´ëŠ”ë°)* ì¼í•˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í‘¸ì‹œ ì•Œë¦¼ ì˜ˆì•½ ê¸°ëŠ¥ì€ `zonedSchedule()`ì„ í™œìš©í•´ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ì¼ì •ì„ ë“±ë¡í•  ë•Œì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ë¡œì§ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.

> 1. ë“±ë¡í•˜ë ¤ëŠ” ê²°í˜¼ì‹ ì¼ì •ì˜ (ë‚ ì§œ - 1ì¼)ì˜ ì˜¤ì „ 9ì‹œì— í‘¸ì‹œ ì•Œë¦¼ì„ ì˜ˆì•½
> 2. ë§Œì•½ ê²°í˜¼ì‹ ì¼ì •ì´ ë‚´ì¼ì´ë¼ë©´ ë‹¹ì¼ ì˜¤ì „ 9ì‹œì— í‘¸ì‹œ ì•Œë¦¼ì„ ì˜ˆì•½
> 3. ê²°í˜¼ì‹ ì¼ì •ì´ ì˜¤ëŠ˜ì„ í¬í•¨í•˜ì—¬ ê³¼ê±°ë¼ë©´ í‘¸ì‹œ ì•Œë¦¼ì„ ì˜ˆì•½í•˜ì§€ ì•ŠìŒ

ì´ë¥¼ í™•ì¸í•˜ì—¬ ì¼ì •ì„ ë“±ë¡í•˜ëŠ” ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

```dart
// NotificationService
Future<void> checkPreviousDayForNotify({
  required Schedule schedule,
}) async {
  final int id = await UrlHash.hashUrlToInt(schedule.link);
  String title = "ë‚´ì¼ ${schedule.groom} & ${schedule.bride}ë‹˜ì˜ ê²°í˜¼ì‹ì´ ìˆìŠµë‹ˆë‹¤!";
  tz.TZDateTime scheduleDate =
      _timeZoneSetting(scheduleDate: schedule.date, hour: 9, minute: 0);

  final now = tz.TZDateTime.now(scheduleDate.location);
  final todayEleven = tz.TZDateTime(
      scheduleDate.location, now.year, now.month, now.day, 11, 0);

  if (scheduleDate.isAtSameMomentAs(todayEleven) &&
      now.isAfter(todayEleven)) {
    final DateTime tomorrow = DateTime.now().add(const Duration(days: 1));
    scheduleDate = tz.TZDateTime(scheduleDate.location, tomorrow.year,
        tomorrow.month, tomorrow.day, 9, 0);
    title = "ì˜¤ëŠ˜ ${schedule.groom} & ${schedule.bride}ë‹˜ì˜ ê²°í˜¼ì‹ì´ ìˆìŠµë‹ˆë‹¤!";
  } else if (scheduleDate.isBefore(todayEleven)) {
    return;
  }

  await addNotifySchedule(
      id: id, appName: 'ì²­ëª¨', title: title, scheduleDate: scheduleDate);
}
```

ì—¬ê¸°ì„œ `addNotifySchedule()`ì€ `zonedSchedule()`ì„ í™œìš©í•´ í‘¸ì‹œ ì•Œë¦¼ì„ ì˜ˆì•½í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

```dart
Future<void> addNotifySchedule(
    {required int id,
    required String appName,
    required String title,
    required tz.TZDateTime scheduleDate}) async {

  await _localNotifyPlugin.zonedSchedule(
    id,
    "ì²­ëª¨",
    title,
    scheduleDate,
    details,
    uiLocalNotificationDateInterpretation:
        UILocalNotificationDateInterpretation.absoluteTime,
    androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle,
    payload: scheduleDate.toIso8601String(),
  );
}
```

ì¼ì •ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì‚­ì œí•˜ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œìš”?

> 1. ê¸°ì¡´ ì˜ˆì•½ëœ í‘¸ì‹œ ì•Œë¦¼ì„ ì‚­ì œ
> 2. ê²°í˜¼ì‹ ë‚ ì§œê°€ ìˆ˜ì •ë˜ì—ˆë‹¤ë©´ ìƒˆë¡­ê²Œ í‘¸ì‹œ ì•Œë¦¼ì„ ì˜ˆì•½

ì´ ê³¼ì •ì—ì„œ ê¸°ì¡´ ì˜ˆì•½ëœ í‘¸ì‹œ ì•Œë¦¼ì„ ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í–ˆê³ ,
ìš°ë¦¬ëŠ” `Schedule` ëª¨ë¸ì—ì„œ `link`ë¥¼ í‚¤ë¡œ ì‚¬ìš©í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì— ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í‘¸ì‹œ ì•Œë¦¼ ë“±ë¡í•  ë•Œ `id`ë¥¼ ì„¤ì •, ì°¾ì•„ì„œ ì‚­ì œí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```dart
Future<void> cancelNotifySchedule({required String link}) async {
  final int id = await UrlHash.hashUrlToInt(link);
  await _localNotifyPlugin.cancel(id);
}
```

ë˜í•œ ì•±ì´ êº¼ì ¸ìˆëŠ” ìƒíƒœì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì„ ëˆŒëŸ¬ ì•±ì„ í‚¤ë©´ í•´ë‹¹ ì¼ì •ì´ ë‚˜ì˜¤ëŠ” í˜ì´ì§€ë¡œ ì´ë™í•´ì•¼ í•©ë‹ˆë‹¤.
ì´ ê¸°ëŠ¥ì€ `onDidReceiveNotificationResponse`ë¥¼ ì„¤ì •í•˜ì—¬ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

```dart
Future<void> onDidReceiveNotificationResponse({required String link}) async {
  final GetScheduleByLinkUsecase getScheduleByLinkUsecase =
      getIt<GetScheduleByLinkUsecase>();
  final Schedule? targetSchedule =
      await getScheduleByLinkUsecase.execute(link);
  if (targetSchedule != null) {
    Get.toNamed('/');
    Get.toNamed('/detail', arguments: targetSchedule);
  } else {
    Get.toNamed('/');
  }
}
```

í‘¸ì‹œ ì•Œë¦¼ì€ êµ¬í˜„ ìì²´ëŠ” ê°„ë‹¨í•˜ì§€ë§Œ ì´ì²˜ëŸ¼ ê³ ë ¤í•  ì‹œë‚˜ë¦¬ì˜¤ë“¤ì´ ë§ì•˜ìŠµë‹ˆë‹¤.
ë˜í•œ ë„¤ì´í‹°ë¸Œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ” ë§Œí¼ ê° OSë³„ ê¶Œí•œ ì„¤ì •ì„ ì˜ ì•Œê³  ìˆì–´ì•¼ í–ˆìŠµë‹ˆë‹¤.
ì´ë²ˆì— **"ì²­ëª¨"** í”„ë¡œì íŠ¸ì—ì„œ ë¡œì»¬ í‘¸ì‹œ ì•Œë¦¼ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì—¬ ë‹¤ìŒì—ë„ ë¹„ìŠ·í•œ ë°©ì‹ì˜ êµ¬í˜„ì„ í•  ìˆ˜ ìˆê² ë‹¤ëŠ” ìì‹ ê°ì´ ìƒê²¼ìŠµë‹ˆë‹¤.

### Trouble Shooting #3 : í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Mock-Up ë ˆí¬ì§€í† ë¦¬ ë§Œë“¤ê¸°

í”ŒëŸ¬í„°ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ë§ì´ ìˆì§€ë§Œ, ì˜ì¡´ì„± ì£¼ì…ì„ í•¨ê»˜ ê³ ë ¤í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ë•Œì—ëŠ” `Mockito` ë§Œí•œê²Œ ì—†ì—ˆìŠµë‹ˆë‹¤.
`Mockito`ë¥¼ `injectable`ê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ë©´, `data sources`ë‚˜ `repository` ë“±ì„ `Mock` ê°ì²´ë¡œ ë§Œë“¤ì–´ì„œ ì˜ì¡´ì„± ì£¼ì…ê¹Œì§€ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê·¸ëŸ¬ë©´ ìœ„ì ¯/ìœ ë‹› ë‹¨ìœ„ì˜ í…ŒìŠ¤íŠ¸ë¥¼ í•  ë•Œ í•´ë‹¹ `Mock` ê°ì²´ë¥¼ ì£¼ì…í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.

"ì²­ëª¨" í”„ë¡œì íŠ¸ëŠ” ê·œëª¨ê°€ í¬ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— UI ë¶€ë¶„ì˜ í…ŒìŠ¤íŠ¸ëŠ” í¬ê²Œ í•„ìš”í•˜ì§€ ì•Šë‹¤ê³  ëŠê¼ˆê³ ,
ê·¸ë˜ì„œ ë°ì´í„° ì²˜ë¦¬ ë° í‘¸ì‹œ ì•Œë¦¼ ê´€ë ¨ëœ ê¸°ëŠ¥ë§Œ í…ŒìŠ¤íŠ¸í•˜ë©´ ë˜ê² ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì„ `data/repository`ë¡œ ì„¤ì •í–ˆê³ , í•´ë‹¹ `repository`ë¥¼ í…ŒìŠ¤íŠ¸ í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì˜ì¡´ì„±ë“¤ì„ `mockito`ë¥¼ í†µí•´ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

ë¨¼ì € `RemoteSource`ë¥¼ êµ¬í˜„í•  ë•Œ `@lazySingleton` ì–´ë…¸í…Œì´ì…˜ì„ ì„¤ì •í•˜ì—¬ `injectable`ì´ `build_runner`ë¥¼ í†µí•´ ê°ì²´ë¥¼ ìƒì„±í•˜ê²Œë” í•˜ì˜€ìŠµë‹ˆë‹¤. `LocalSource`, `NotificationService`ë„ ë§ˆì°¬ê°€ì§€ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

```dart
@LazySingleton(as: ScheduleRemoteSource)
class ScheduleRemoteSourceImpl implements ScheduleRemoteSource {
  final Dio dio = Dio();

  ScheduleRemoteSourceImpl();

  /// Fetch analyzed data in `json` type from Firebase functions API.
  ///
  /// If result, returns `ScheduleModel` type data.
  ///
  /// If not, throw error.
  @override
  Future<ScheduleModel> fetchScheduleFromServer(String link) async {
    try {
      final response = await dio.post('${Env.url}/', data: {'link': link});
      if (response.statusCode == 200) {
        return ScheduleModel.fromJson(
            jsonDecode(response.data)..addAll({'link': link}));
      } else {
        throw Exception('[-] Failed to fetch data from server');
      }
    } catch (e) {
      throw Exception('[-] Failed to fetch data from server');
    }
  }
}
```

ì´í›„ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ êµ¬í˜„í•  ë•Œ ì•„ë˜ì™€ ê°™ì´ `mocks.dart` íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ **Mock ê°ì²´**ë¥¼ ìƒì„±í•˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.

```dart
@GenerateMocks([
  ScheduleLocalSource,
  ScheduleRemoteSource,
  NotificationService,
])
void main() {}
```

`build_runner`ë¥¼ ëŒë¦¬ë©´, ë‹¤ìŒê³¼ ê°™ì´ `mocks.mocks.dart` íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

```dart
import 'dart:async' as _i5;

import 'package:chungmo/core/services/notification_service.dart' as _i7;
import 'package:chungmo/data/models/schedule/schedule_model.dart' as _i2;
import 'package:chungmo/data/sources/local/schedule_local_source.dart' as _i4;
import 'package:chungmo/data/sources/remote/schedule_remote_source.dart' as _i6;
import 'package:chungmo/domain/entities/schedule.dart' as _i8;
import 'package:flutter_local_notifications/flutter_local_notifications.dart'
    as _i3;
import 'package:mockito/mockito.dart' as _i1;
import 'package:timezone/timezone.dart' as _i9;

/// A class which mocks [ScheduleRemoteSource].
///
/// See the documentation for Mockito's code generation for more information.
class MockScheduleRemoteSource extends _i1.Mock
    implements _i6.ScheduleRemoteSource {
  MockScheduleRemoteSource() {
    _i1.throwOnMissingStub(this);
  }

  @override
  _i5.Future<_i2.ScheduleModel> fetchScheduleFromServer(String? url) =>
      (super.noSuchMethod(
            Invocation.method(#fetchScheduleFromServer, [url]),
            returnValue: _i5.Future<_i2.ScheduleModel>.value(
              _FakeScheduleModel_0(
                this,
                Invocation.method(#fetchScheduleFromServer, [url]),
              ),
            ),
          )
          as _i5.Future<_i2.ScheduleModel>);
}
```

ì´ì œ **Mock ê°ì²´**ë¥¼ í™œìš©í•´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```dart
import '../../mocks/mocks.mocks.dart'; // build_runnerë¡œ ìƒì„±ëœ íŒŒì¼

void main() {
  late ScheduleRepositoryImpl repository;
  late MockScheduleRemoteSource mockRemoteSource;
  late MockScheduleLocalSource mockLocalSource;
  late MockNotificationService mockNotificationService;

  setUp(() {
    mockRemoteSource = MockScheduleRemoteSource();
    mockLocalSource = MockScheduleLocalSource();
    mockNotificationService = MockNotificationService();
    repository = ScheduleRepositoryImpl(
        mockRemoteSource, mockLocalSource, mockNotificationService);
  });

  group('analyzeLink', () {
    test('should return Schedule when remote source call is successful',
        () async {
      // Given
      when(mockRemoteSource.fetchScheduleFromServer(any))
          .thenAnswer((_) async => tScheduleModel);

      // When
      final result = await repository.analyzeLink(tUrl);

      // Then
      expect(result, tSchedule);
      verify(mockRemoteSource.fetchScheduleFromServer(tUrl)).called(1);
    });
  });
}
```

ì´ë¥¼ í†µí•´ ì˜ì¡´ì„±ì´ ë³µì¡í•˜ê²Œ êµ¬í˜„ëœ í”„ë¡œì íŠ¸ì—ì„œë„ ê°„í¸í•˜ê²Œ **Mock ê°ì²´**ë¥¼ ìƒì„±í•˜ì—¬ ì•ˆì „í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

### ê·¸ ì™¸ ì‚¬ìš©í•œ ê¸°ë²•ê³¼ ê·¼ê±°

#### 1. ìƒíƒœ ê´€ë¦¬ë„êµ¬ë¥¼ ì™œ GetXë¡œ í–ˆë‚˜?

![ì›í”¼ìŠ¤ í•´êµ° 3ëŒ€ì¥ì— BloC, Provider, GetX ë¡œê³ ë¥¼ í•©ì„±í•œ ê·¸ë¦¼](https://velog.velcdn.com/images/taebbong/post/8a52f1de-8347-4781-9ff0-29ac4b57c929/image.jpg)

í”ŒëŸ¬í„°ì—ëŠ” ìƒíƒœ ê´€ë¦¬ ë„êµ¬ 3ëŒ€ì¥ì´ ìˆìŠµë‹ˆë‹¤. `BloC`, `Provider`, `GetX`ê°€ ê·¸ê²ƒì…ë‹ˆë‹¤.
~~Riverpodë„ ì‹¬ì‹¬ì°®ê²Œ ë³´ì´ì§€ë§Œ, ì•„ì§ ì œê²Œ ìµìˆ™ì¹˜ëŠ” ì•ŠìŠµë‹ˆë‹¤.~~
~~ì»¤ë®¤ë‹ˆí‹° í™œë™ì„ ì•ˆí•´ì„œ ëª°ëëŠ”ë°, GetXëŠ” ì¢€ ë§ì´ ë°°ì²™ë˜ê³  Riverpodì´ ë“¤ì–´ê°€ëŠ” ëŠë‚Œì´ë„¤ìš”.~~

ê° ìƒíƒœ ê´€ë¦¬ ë„êµ¬ëŠ” ê°œì„±ì´ ê°•í•˜ê³  ì¥ë‹¨ì ì´ ëª…í™•í•œë°,

ë¨¼ì € `BloC`ì€ í˜„ì¬, ê·¸ë¦¬ê³  ì•ìœ¼ë¡œë„ `Stream`ì„ ì‚¬ìš©í•  ê³„íšì´ ì—†ê³ , í”„ë¡œì íŠ¸ ê·œëª¨ë¥¼ ê³ ë ¤í–ˆì„ ë•Œ í•˜ë‚˜ì˜ ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•´ ë„ˆë¬´ ë§ì€ íŒŒì¼ì´ ìƒê¸´ë‹¤ê³  íŒë‹¨í•´ ì œì™¸í•˜ì˜€ìŠµë‹ˆë‹¤.

`Provider`ì™€ `GetX`ëŠ” ë‘˜ë‹¤ ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©í•˜ê¸°ì—ëŠ” ê°„ë‹¨í•˜ê³  ì¢‹ì€ ë°©ë²•ë“¤ì…ë‹ˆë‹¤.
ë‘˜ ì¤‘ì—ì„œëŠ” ì´í›„ ë¼ìš°íŒ…ì´ë‚˜ ë‹¤ì´ì–¼ë¡œê·¸, ìŠ¤ë‚µë°” ë“± ìœ„ì ¯ ë ˆë²¨ì—ì„œ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆëŠ” `GetX`ë¥¼ ì±„íƒí•˜ì˜€ìŠµë‹ˆë‹¤.
ì´ëŠ” ì–´ë–»ê²Œ ë³´ë©´ ìƒíƒœ ê´€ë¦¬ ë„êµ¬ë¡œì¨ ì„ íƒí–ˆë‹¤ê¸°ë³´ë‹¨ í•˜ë‚˜ì˜ í”„ë ˆì„ì›Œí¬ë¡œ ì„ íƒí–ˆë‹¤ê³  ë³´ëŠ”ê²Œ ë” ì í•©í•˜ê² ë„¤ìš”.
ì–´ë””ê¹Œì§€ë‚˜ ë¹ ë¥¸ ê¸°ëŠ¥ ê°œë°œì„ ëª©í‘œë¡œ í–ˆê¸°ì—, ë¼ìš°íŒ…ê³¼ UI ì˜ì—­ì—ì„œì˜ `GetX`ì˜ ì¥ì ì„ ë†“ì¹˜ê¸°ì—” ì•„ì‰¬ì› ìŠµë‹ˆë‹¤.

#### 2. ì™œ GetXì™€ StatefulWidgetì„ í•¨ê»˜ ì“°ëŠ”ê°€?

`GetX`ëŠ” ê·¸ ìì²´ë¡œ ì˜¨ì „í•œ ìƒíƒœ ê´€ë¦¬ë„êµ¬ë¡œ, ì „ì—­ ë° ì§€ì—­ ìƒíƒœ ê´€ë¦¬ë¥¼ ì¶©ë¶„íˆ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë³´í†µ `GetX`ì—ì„œ ìƒíƒœ ê´€ë¦¬ë¥¼ í•  ë•Œì—ëŠ” **MVVM íŒ¨í„´**ì„ ì ìš©í•˜ì—¬ `view`ì— í•´ë‹¹í•˜ëŠ” `viewmodel(controller)`ë¥¼ ì„ ì–¸í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.
ì´ë•Œ ë‹¤ë¤„ì§€ëŠ” ìƒíƒœê°€ ë§ê±°ë‚˜ `viewmodel`ì—ì„œ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì´ ë§ì€ ê²½ìš° `viewmodel`ì´ ë¹„ëŒ€í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¹„ëŒ€í•œ `viewmodel`ì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆê² ì§€ë§Œ,
ì²­ëª¨ í”„ë¡œì íŠ¸ì—ì„œëŠ” `viewmodel`ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê´€ë¦¬ì— ì§‘ì¤‘í•˜ê³  UIì™€ ê´€ë ¨ëœ ë‹¨ìˆœ ìƒíƒœëŠ” `StatefulWidget`ìœ¼ë¡œ ê´€ë¦¬í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

```dart
class _DetailPageState extends State<DetailPage> {
  bool editMode = false; // ìˆ˜ì • ìƒíƒœì¸ì§€ í™•ì¸

  final DetailController controller = Get.put(DetailController()); // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ViewModel
  final TextEditingController groomController = TextEditingController(); // í…ìŠ¤íŠ¸ ì…ë ¥ ì»¨íŠ¸ë¡¤ëŸ¬
  final TextEditingController brideController = TextEditingController();
  final TextEditingController locationController = TextEditingController();
  final TextEditingController linkController = TextEditingController();
  DateTime? selectedDate; // í˜„ì¬ í˜ì´ì§€ì—ì„œ ì„ íƒëœ ë‚ ì§œ
  ...
}
```

ì´ì™€ ê°™ì´ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì¢€ ë” ëª…ë£Œí•œ ì½”ë“œ êµ¬ì¡°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

#### 3. ì˜ì¡´ì„± ê´€ë¦¬ëŠ” ì–´ë–»ê²Œ?

ì˜ì¡´ì„± ì£¼ì… ë° ê´€ë¦¬ì—ëŠ” `injectable`ê³¼ `get_it`ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤,
`GetX`ì—ëŠ” `Get.put`, `Get.find`ë¼ëŠ” ì•„ì£¼ í¸ë¦¬í•œ ì˜ì¡´ì„± ê´€ë¦¬ ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.
ê·¸ëŸ¼ì—ë„ `injectable`ê³¼ `get_it`ì„ ì‚¬ìš©í•œ ê²ƒì€ `GetX` ì˜ì¡´ë„ë¥¼ ë‚®ì¶”ê³ , ë‹¤ë¥¸ ìƒíƒœ ê´€ë¦¬ë„êµ¬ì™€ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë²”ìš©ì„±ì„ í™•ë³´í•˜ê¸° ìœ„í•¨ì´ì—ˆìŠµë‹ˆë‹¤.

ì‚¬ì‹¤ í”„ë¡œì íŠ¸ì—ì„œ `injectable`ê³¼ `get_it`ì„ ì‚¬ìš©í•œ ê²ƒì€ ì²˜ìŒì´ì—ˆëŠ”ë°, ìƒê°ë³´ë‹¤ ì‚¬ìš©í•˜ê¸° í¸ë¦¬í–ˆìŠµë‹ˆë‹¤.
ë¬´ì—‡ë³´ë‹¤ `build_runner` ê¸°ë°˜ì˜ ìë™ ìƒì„± ê¸°ëŠ¥ì´ í¸ë¦¬í–ˆìŠµë‹ˆë‹¤.

```dart
@LazySingleton(as: ScheduleRepository)
class ScheduleRepositoryImpl implements ScheduleRepository {
  ...
}

@injectable
class AnalyzeLinkUsecase {
  ...
}
```

ìœ„ì™€ ê°™ì´ ì˜ì¡´ì„± ê´€ë¦¬ê°€ í•„ìš”í•œ ëŒ€ìƒ í´ë˜ìŠ¤ì— `LazySingleton`, `injectable`ê³¼ ê°™ì€ ì–´ë…¸í…Œì´ì…˜ì„ ë„£ì–´ ì„ ì–¸í•©ë‹ˆë‹¤.

> `LazySingleton`ì€ í•´ë‹¹ ê°ì²´ê°€ ì²˜ìŒ ì‚¬ìš©ë  ë•Œ ì‹±ê¸€í†¤ ë°©ì‹ìœ¼ë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
> `injectable`ì€ í•´ë‹¹ ê°ì²´ë¥¼ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

```dart
import 'package:get_it/get_it.dart';
import 'package:injectable/injectable.dart';

import 'di.config.dart';

final GetIt getIt = GetIt.instance;

@InjectableInit()
Future<void> configureDependencies() async => getIt.init();
```

`di.dart` íŒŒì¼ì„ ìœ„ì²˜ëŸ¼ ì„ ì–¸í•˜ê³  `build_runner`ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ `di.config.dart` íŒŒì¼ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.

```dart
import 'package:get_it/get_it.dart' as _i174;
import 'package:injectable/injectable.dart' as _i526;

extension GetItInjectableX on _i174.GetIt {
// initializes the registration of main-scope dependencies inside of GetIt
  _i174.GetIt init({
    String? environment,
    _i526.EnvironmentFilter? environmentFilter,
  }) {
    final gh = _i526.GetItHelper(
      this,
      environment,
      environmentFilter,
    );
    gh.lazySingleton<_i109.NotificationService>(
        () => _i109.NotificationServiceImpl());
    gh.lazySingleton<_i1014.ScheduleLocalSource>(
        () => _i1014.ScheduleLocalSourceImpl());
    gh.lazySingleton<_i153.ScheduleRemoteSource>(
        () => _i153.ScheduleRemoteSourceImpl());
    gh.lazySingleton<_i561.ScheduleRepository>(
        () => _i798.ScheduleRepositoryImpl(
              gh<_i153.ScheduleRemoteSource>(),
              gh<_i1014.ScheduleLocalSource>(),
              gh<_i109.NotificationService>(),
            ));
    gh.factory<_i407.ListSchedulesUsecase>(
        () => _i407.ListSchedulesUsecase(gh<_i561.ScheduleRepository>()));
        ...
  }
  ...
}
```

ì´í›„ í•„ìš”í•œ ì˜ì¡´ì„±ì„ ì£¼ì…ì‹œì¼œ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë• `getIt` ê°ì²´ë¥¼ í†µí•´ ì ‘ê·¼í•˜ë©´ ë©ë‹ˆë‹¤.

```dart
final ListSchedulesByDateUsecase listSchedulesByDateUsecase = getIt<ListSchedulesByDateUsecase>();
```

### ë°°í¬ ì™„ë£Œ : ë‹¤ìŒ ë²„ì „ì€?

![ë°ëª¨ ì˜ìƒ]()

ì•„ì£¼ ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ë§Œ êµ¬í˜„í•œ í˜„ì¬ ë²„ì „ 1.0.0ì€ í”Œë ˆì´ìŠ¤í† ì–´ì— ë¬´ì‚¬íˆ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤.
ë°°í¬í•  ë•Œ ì¯¤ ë§¥ë¶ì„ êµì²´í•˜ëŠë¼ ì•±ìŠ¤í† ì–´ ë°°í¬ëŠ” ë†“ì³¤ëŠ”ë°, ë‹¤ìŒ ë²„ì „ì— í•¨ê»˜ ë°°í¬í•˜ë ¤ê³  í•©ë‹ˆë‹¤.

ë‹¤ìŒ ë²„ì „ì— ë„£ê³  ì‹¶ì€ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ì€ë°,

> 1. `showcaseview` íŒ¨í‚¤ì§€ ê¸°ë°˜ ì˜¨ë³´ë”© í”„ë¡œì„¸ìŠ¤ ì¶”ê°€
> 2. ë©”ì¸ í˜ì´ì§€ UIì— ì¼ì • ë°ì´í„° ì¶”ê°€ë¡œ ë³´ì—¬ì£¼ê¸°
> 3. ê³„ì¢Œ ì •ë³´ ì¶”ê°€
> 4. ì£¼ì†Œ ë³µì‚¬ ë²„íŠ¼ ì¶”ê°€

ë¹„êµì  ê°„ë‹¨í•œ ê¸°ëŠ¥ë“¤ ìœ„ì£¼ë¡œ ë‹¤ìŒ ë²„ì „ì„ ì¤€ë¹„í•˜ë ¤ê³  í•©ë‹ˆë‹¤.

### ê°œì„ í•  ì , ë§ˆì¹˜ë©°

í•œë²ˆì— ì™„ë²½í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì€ ì•Œì§€ë§Œ, ê·¸ëŸ¼ì—ë„ ë³¼ ë•Œë§ˆë‹¤ ì•„ì‰¬ìš´ ì ì´ ìƒê¸°ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.
ìµœê·¼ ì»¤ë®¤ë‹ˆí‹°ë‚˜ ì„¸ë¯¸ë‚˜ë¥¼ í†µí•´ ìƒˆë¡­ê²Œ ì•Œì•„ê°€ëŠ” ë‚´ìš©ì´ ìˆëŠ”ë°, ì´ëŸ° ë¶€ë¶„ë“¤ì„ ì ìš©í•˜ë©´ ì¢€ ë” ì¢‹ì€ í”„ë¡œì íŠ¸ê°€ ë˜ê² ë‹¤ ëŠê»´ì§‘ë‹ˆë‹¤.

> 1. `Isolate` ì ìš©í•˜ì—¬ ì„±ëŠ¥ ê°œì„ 
> 2. `Stream` ì ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ìƒíƒœ ê´€ë¦¬, êµ¬ë…
> 3. ì ê·¹ì ì¸ ê°ì²´ì§€í–¥ ê°œë… ì ìš©, ë¦¬íŒ©í† ë§

<img src="https://velog.velcdn.com/images/taebbong/post/98ce493e-05a3-4cc4-8638-01c00c451c95/image.png" width="70%">

ì—¬ê¸°ê¹Œì§€ ì œ ì‘ê³  ì†Œì¤‘í•œ **"ì²­ëª¨"** í”„ë¡œì íŠ¸ì˜€ìŠµë‹ˆë‹¤. ì§€ê¸ˆì€ ë§ì´ ë¶€ì¡±í•˜ì§€ë§Œ ì¢€ ë” ì‹œê°„ì´ ì§€ë‚œ í›„, ë” ë©‹ì§„ í”„ë¡œì íŠ¸ê°€ ë˜ì–´ ìƒˆë¡­ê²Œ ì–»ì€ ê²½í—˜ë“¤ì„ ê³µìœ í•˜ê² ìŠµë‹ˆë‹¤. ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!
